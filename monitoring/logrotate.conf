# Log rotation configuration for Teder Trading Bot

/opt/teder/logs/*.log {
    # Rotate daily
    daily
    
    # Keep 7 days of logs
    rotate 7
    
    # Don't rotate if empty
    notifempty
    
    # Missing log files are ok
    missingok
    
    # Compress old logs
    compress
    delaycompress
    
    # Use date as suffix
    dateext
    dateformat -%Y%m%d
    
    # Create new log files with specific permissions
    create 644 teder teder
    
    # Don't rotate if size is less than 1M
    minsize 1M
    
    # Rotate if larger than 50M regardless of time
    maxsize 50M
    
    # Copy and truncate instead of moving
    copytruncate
    
    # Execute after rotation
    postrotate
        # Send HUP signal to docker containers if needed
        /usr/bin/docker kill --signal=HUP teder-trading-bot 2>/dev/null || true
    endscript
    
    # Pre-rotation script
    prerotate
        # Check if container is running
        /usr/bin/docker ps --format "{{.Names}}" | grep -q teder-trading-bot || exit 1
    endscript
}

# Specific configuration for critical logs
/opt/teder/logs/live_trading.log {
    daily
    rotate 30
    compress
    delaycompress
    copytruncate
    create 644 teder teder
    notifempty
    missingok
    maxsize 100M
}

# Error logs - keep longer
/opt/teder/logs/error.log {
    daily
    rotate 30
    compress
    delaycompress
    copytruncate
    create 644 teder teder
    notifempty
    missingok
    maxsize 100M
}

# Docker logs
/var/lib/docker/containers/*/*-json.log {
    daily
    rotate 3
    compress
    delaycompress
    copytruncate
    create 644 root root
    notifempty
    missingok
    maxsize 10M
}